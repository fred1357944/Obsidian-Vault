/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};
var __publicField = (obj, key, value) => {
  __defNormalProp(obj, typeof key !== "symbol" ? key + "" : key, value);
  return value;
};

// src/main.ts
__export(exports, {
  default: () => SettingsSearch
});
var import_obsidian = __toModule(require("obsidian"));

// node_modules/monkey-around/mjs/index.js
function around(obj, factories) {
  const removers = Object.keys(factories).map((key) => around1(obj, key, factories[key]));
  return removers.length === 1 ? removers[0] : function() {
    removers.forEach((r) => r());
  };
}
function around1(obj, method, createWrapper) {
  const original = obj[method], hadOwn = obj.hasOwnProperty(method);
  let current = createWrapper(original);
  if (original)
    Object.setPrototypeOf(current, original);
  Object.setPrototypeOf(wrapper, current);
  obj[method] = wrapper;
  return remove;
  function wrapper(...args) {
    if (current === original && obj[method] === wrapper)
      remove();
    return current.apply(this, args);
  }
  function remove() {
    if (obj[method] === wrapper) {
      if (hadOwn)
        obj[method] = original;
      else
        delete obj[method];
    }
    if (current === original)
      return;
    current = original;
    Object.setPrototypeOf(wrapper, original || Function);
  }
}

// src/main.ts
var SettingsSearch = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    __publicField(this, "settingsSearchEl", createDiv("settings-search-container vertical-tab-header-group"));
    __publicField(this, "settingsResultsContainerEl", createDiv("settings-search-results-container vertical-tab-content"));
    __publicField(this, "settingsNavItemContainer", this.settingsSearchEl.createDiv("vertical-tab-header-group-items").createDiv("vertical-tab-nav-item settings-search-input"));
    __publicField(this, "settingsResultsEl");
    __publicField(this, "search");
    __publicField(this, "locale");
    __publicField(this, "resources", []);
    __publicField(this, "results", []);
    __publicField(this, "tabIndex", 0);
    __publicField(this, "pluginTabIndex", 0);
    __publicField(this, "settingCache", new Map());
    __publicField(this, "searchAppended", false);
    __publicField(this, "activeIndex", -1);
    __publicField(this, "activeSetting");
    __publicField(this, "scope", new import_obsidian.Scope(this.app.scope));
  }
  async onload() {
    this.app.workspace.onLayoutReady(async () => {
      this.settingsResultsContainerEl.createEl("h3", {
        text: "Settings Search Results"
      });
      this.settingsResultsEl = this.settingsResultsContainerEl.createDiv("settings-search-results");
      this.buildScope();
      this.buildSearch();
      this.buildResources();
      this.buildPluginResources();
      this.patchSettings();
    });
  }
  buildResources() {
    const tab = this.app.setting.settingTabs[this.tabIndex];
    if (tab) {
      this.getTabResources(tab);
      this.tabIndex++;
      setImmediate(() => this.buildResources());
    }
  }
  buildPluginResources() {
    const tab = this.app.setting.pluginTabs[this.pluginTabIndex];
    if (tab) {
      this.getTabResources(tab);
      this.pluginTabIndex++;
      setImmediate(() => this.buildPluginResources());
    }
  }
  get manifests() {
    return Object.values(this.app.plugins.manifests);
  }
  addResourceToCache(resource) {
    const setting = new import_obsidian.Setting(createDiv()).setName(resource.text).setDesc(createFragment((e) => e.createDiv().innerHTML = resource.desc ?? ""));
    if (resource.tab == "community-plugins") {
      let plugin = this.manifests.find((p) => p.name == resource.text);
      if (plugin && this.app.plugins.getPlugin(plugin.id)?._loaded && this.app.setting.pluginTabs.find((t) => t.id == plugin.id)) {
        setting.addExtraButton((b) => {
          b.setTooltip(`Open ${resource.text} Settings`).onClick(() => {
            this.app.setting.openTabById(plugin.id);
          });
        });
      }
    }
    if (resource.tab == "plugins") {
      const plugins = Object.values(this.app.internalPlugins.plugins);
      const plugin = plugins.find((p) => p._loaded && p.instance.name == resource.text);
      if (plugin && this.app.setting.pluginTabs.find((t) => t.id == plugin.instance.id)) {
        setting.addExtraButton((b) => {
          b.setTooltip(`Open ${resource.text} Settings`).onClick(() => {
            this.app.setting.openTabById(plugin.instance.id);
          });
        });
      }
    }
    setting.addExtraButton((b) => {
      b.setIcon("forward-arrow").onClick(() => {
        this.showResult(resource);
      });
    });
    this.settingCache.set(resource.text, setting);
  }
  getResourceFromCache(resource) {
    if (!this.settingCache.has(resource.text)) {
      this.addResourceToCache(resource);
    }
    return this.settingCache.get(resource.text);
  }
  removeResourcesFromCache(resources) {
    for (const resource of resources) {
      this.settingCache.delete(resource.text);
    }
  }
  async getTabResources(tab) {
    await tab.display();
    const settings = tab.containerEl.querySelectorAll(".setting-item:not(.setting-item-header)");
    for (const el of Array.from(settings)) {
      const text = el.querySelector(".setting-item-name")?.textContent;
      if (!text)
        continue;
      const desc = el.querySelector(".setting-item-description")?.innerHTML ?? "";
      const resource = {
        tab: tab.id,
        name: tab.name,
        text,
        desc
      };
      this.resources.push(resource);
      this.addResourceToCache(resource);
    }
    if (this.app.setting.activeTab?.id == tab.id)
      return;
    tab.containerEl.detach();
    tab.hide();
  }
  patchSettings() {
    const self = this;
    this.register(around(this.app.setting, {
      onOpen: function(next) {
        return function() {
          next.apply(this);
          self.search.inputEl.focus();
          return next;
        };
      }
    }));
    this.register(around(this.app.setting, {
      addSettingTab: function(next) {
        return function(tab) {
          self.getTabResources(tab);
          return next.call(this, tab);
        };
      }
    }));
    this.register(around(this.app.setting, {
      removeSettingTab: function(next) {
        return function(tab) {
          if (this.isPluginSettingTab(tab)) {
            const removing = self.resources.filter((t) => t.tab == tab.id);
            self.resources = self.resources.filter((t) => t.tab != tab.id);
            self.removeResourcesFromCache(removing);
          }
          return next.call(this, tab);
        };
      }
    }));
    this.register(around(this.app.setting, {
      openTab: function(next) {
        return function(tab) {
          self.searchAppended = false;
          return next.call(this, tab);
        };
      },
      openTabById: function(next) {
        return function(tab) {
          self.searchAppended = false;
          return next.call(this, tab);
        };
      }
    }));
  }
  buildSearch() {
    const tempSetting = new import_obsidian.Setting(createDiv()).addSearch((s) => {
      this.search = s;
    });
    this.settingsNavItemContainer.append(tempSetting.controlEl);
    tempSetting.settingEl.detach();
    this.search.onChange((v) => {
      this.onChange(v);
    });
    this.search.setPlaceholder("Search settings...");
    this.app.setting.tabHeadersEl.prepend(this.settingsSearchEl);
  }
  buildScope() {
    this.scope.register([], "ArrowDown", () => {
      console.log("arrowdown");
      if (this.activeSetting) {
        this.activeSetting.settingEl.removeClass("active");
      }
      this.activeIndex = ((this.activeIndex + 1) % this.results.length + this.results.length) % this.results.length;
      this.centerActiveSetting();
    });
    this.scope.register([], "ArrowUp", () => {
      console.log("arrow up");
      if (this.activeSetting) {
        this.activeSetting.settingEl.removeClass("active");
      }
      this.activeIndex = ((this.activeIndex - 1) % this.results.length + this.results.length) % this.results.length;
      this.centerActiveSetting();
    });
  }
  centerActiveSetting() {
    const result = this.results[this.activeIndex];
    this.activeSetting = this.getResourceFromCache(result);
    this.activeSetting.settingEl.addClass("active");
    console.log("\u{1F680} ~ file: main.ts ~ line 333 ~ this.activeSetting.settingEl", this.activeSetting.settingEl);
    this.activeSetting.settingEl.scrollIntoView({
      behavior: "auto",
      block: "nearest"
    });
  }
  onChange(v) {
    if (!v) {
      this.app.setting.openTabById(this.app.setting.lastTabId);
      this.searchAppended = false;
      this.app.keymap.popScope(this.scope);
      this.activeIndex = -1;
      return;
    }
    if (!this.searchAppended) {
      this.app.setting.activeTab.navEl.removeClass("is-active");
      this.app.setting.tabContentContainer.empty();
      this.app.setting.tabContentContainer.append(this.settingsResultsContainerEl);
      this.searchAppended = true;
      this.app.keymap.pushScope(this.scope);
    }
    this.appendResults(this.performFuzzySearch(v));
  }
  getMatchText(text, result) {
    const matchElements = {};
    return createFragment((content) => {
      for (let i = 0; i < text.length; i++) {
        let match = result.matches.find((m) => m[0] === i);
        if (match) {
          const index = result.matches.indexOf(match);
          if (!matchElements[index]) {
            matchElements[index] = createSpan("suggestion-highlight");
          }
          let element = matchElements[index];
          content.appendChild(element);
          element.appendText(text.substring(match[0], match[1]));
          i += match[1] - match[0] - 1;
          continue;
        }
        content.appendText(text[i]);
      }
    });
  }
  appendResults(results) {
    this.settingsResultsEl.empty();
    if (results.length) {
      const headers = {};
      for (const resource of results) {
        if (!(resource.tab in headers)) {
          headers[resource.tab] = this.settingsResultsEl.createDiv();
          new import_obsidian.Setting(headers[resource.tab]).setHeading().setName(resource.name);
        }
        const setting = this.getResourceFromCache(resource);
        headers[resource.tab].append(setting.settingEl);
      }
    } else {
      this.settingsResultsEl.setText("No results found :(");
    }
  }
  showResult(result) {
    this.search.setValue("");
    const tab = this.app.setting.settingTabs.find((t) => t.id == result.tab) ?? this.app.setting.pluginTabs.find((t) => t.id == result.tab);
    if (!tab) {
      new import_obsidian.Notice("There was an issue opening the setting tab.");
      return;
    }
    this.app.setting.openTabById(tab.id);
    try {
      const names = tab.containerEl.querySelectorAll(".setting-item-name");
      const el = Array.from(names).find((n) => n.textContent == result.text);
      if (!el)
        return;
      const setting = el.closest(".setting-item");
      if (!setting)
        return;
      if (tab.id == "obsidian-style-settings") {
        let collapsed = setting.closest(".style-settings-container");
        let previous = collapsed?.previousElementSibling;
        while (previous != null && previous.hasClass("is-collapsed") && previous.hasClass("style-settings-heading")) {
          previous.removeClass("is-collapsed");
          collapsed = collapsed.parentElement?.closest(".style-settings-container");
          previous = collapsed?.previousElementSibling;
        }
      }
      let details = setting.closest("details");
      while (details) {
        details.setAttr("open", "open");
        details = details.parentElement?.closest("details");
      }
      setting.scrollIntoView(true);
      setting.addClass("is-flashing");
      this.registerInterval(window.setTimeout(() => setting.removeClass("is-flashing"), 3e3));
    } catch (e) {
      console.error(e);
    }
  }
  performFuzzySearch(input) {
    const results = [], hotkeys = [];
    for (const resource of this.resources) {
      let result = (0, import_obsidian.prepareSimpleSearch)(input)(resource.text) ?? (0, import_obsidian.prepareSimpleSearch)(input)(resource.desc);
      if (result) {
        if (resource.tab == "hotkeys") {
          hotkeys.push(resource);
        } else {
          results.push(resource);
        }
      }
    }
    this.results = [...results, ...hotkeys];
    return this.results;
  }
  onunload() {
    this.settingsSearchEl.detach();
    this.settingsResultsEl.detach();
    if (this.searchAppended)
      this.app.setting.openTabById(this.app.setting.lastTabId);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vR2l0SHViL1BlcnNvbmFsL29ic2lkaWFuLXNldHRpbmdzLXNlYXJjaC9zcmMvbWFpbi50cyIsICIuLi8uLi8uLi8uLi9HaXRIdWIvUGVyc29uYWwvb2JzaWRpYW4tc2V0dGluZ3Mtc2VhcmNoL25vZGVfbW9kdWxlcy9tb25rZXktYXJvdW5kL21qcy9pbmRleC5qcyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtcclxuICAgIFBsdWdpbixcclxuICAgIFNlYXJjaENvbXBvbmVudCxcclxuICAgIFNldHRpbmcsXHJcbiAgICBTZWFyY2hSZXN1bHQsXHJcbiAgICBOb3RpY2UsXHJcbiAgICBwcmVwYXJlU2ltcGxlU2VhcmNoLFxyXG4gICAgU2V0dGluZ1RhYixcclxuICAgIFNjb3BlXHJcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG5pbXBvcnQgeyBhcm91bmQgfSBmcm9tIFwibW9ua2V5LWFyb3VuZFwiO1xyXG5cclxuZGVjbGFyZSBtb2R1bGUgXCJvYnNpZGlhblwiIHtcclxuICAgIGludGVyZmFjZSBBcHAge1xyXG4gICAgICAgIGludGVybmFsUGx1Z2luczoge1xyXG4gICAgICAgICAgICBwbHVnaW5zOiBSZWNvcmQ8XHJcbiAgICAgICAgICAgICAgICBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICB7IF9sb2FkZWQ6IGJvb2xlYW47IGluc3RhbmNlOiB7IG5hbWU6IHN0cmluZzsgaWQ6IHN0cmluZyB9IH1cclxuICAgICAgICAgICAgPjtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHBsdWdpbnM6IHtcclxuICAgICAgICAgICAgbWFuaWZlc3RzOiBSZWNvcmQ8c3RyaW5nLCBQbHVnaW5NYW5pZmVzdD47XHJcbiAgICAgICAgICAgIHBsdWdpbnM6IFJlY29yZDxzdHJpbmcsIFBsdWdpbj47XHJcbiAgICAgICAgICAgIGdldFBsdWdpbihpZDogc3RyaW5nKTogUGx1Z2luO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgc2V0dGluZzoge1xyXG4gICAgICAgICAgICBvbk9wZW4oKTogdm9pZDtcclxuXHJcbiAgICAgICAgICAgIG9wZW5UYWJCeUlkKGlkOiBzdHJpbmcpOiB2b2lkO1xyXG4gICAgICAgICAgICBvcGVuVGFiKHRhYjogU2V0dGluZ1RhYik6IHZvaWQ7XHJcblxyXG4gICAgICAgICAgICBpc1BsdWdpblNldHRpbmdUYWIodGFiOiBTZXR0aW5nVGFiKTogYm9vbGVhbjtcclxuICAgICAgICAgICAgYWRkU2V0dGluZ1RhYih0YWI6IFNldHRpbmdUYWIpOiB2b2lkO1xyXG4gICAgICAgICAgICByZW1vdmVTZXR0aW5nVGFiKHRhYjogU2V0dGluZ1RhYik6IHZvaWQ7XHJcblxyXG4gICAgICAgICAgICBhY3RpdmVUYWI6IFNldHRpbmdUYWI7XHJcbiAgICAgICAgICAgIGxhc3RUYWJJZDogc3RyaW5nO1xyXG5cclxuICAgICAgICAgICAgcGx1Z2luVGFiczogUGx1Z2luU2V0dGluZ1RhYltdO1xyXG4gICAgICAgICAgICBzZXR0aW5nVGFiczogU2V0dGluZ1RhYltdO1xyXG5cclxuICAgICAgICAgICAgdGFiQ29udGVudENvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRhYkhlYWRlcnNFbDogSFRNTERpdkVsZW1lbnQ7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGludGVyZmFjZSBQbHVnaW4ge1xyXG4gICAgICAgIF9sb2FkZWQ6IGJvb2xlYW47XHJcbiAgICB9XHJcbiAgICBpbnRlcmZhY2UgUGx1Z2luU2V0dGluZ1RhYiB7XHJcbiAgICAgICAgbmFtZTogc3RyaW5nO1xyXG4gICAgfVxyXG4gICAgaW50ZXJmYWNlIFNldHRpbmdUYWIge1xyXG4gICAgICAgIGlkOiBzdHJpbmc7XHJcbiAgICAgICAgbmFtZTogc3RyaW5nO1xyXG4gICAgICAgIG5hdkVsOiBIVE1MRWxlbWVudDtcclxuICAgIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIFJlc291cmNlIHtcclxuICAgIHRhYjogc3RyaW5nO1xyXG4gICAgdGV4dDogc3RyaW5nO1xyXG4gICAgZGVzYzogc3RyaW5nO1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG59XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNldHRpbmdzU2VhcmNoIGV4dGVuZHMgUGx1Z2luIHtcclxuICAgIHNldHRpbmdzU2VhcmNoRWw6IEhUTUxEaXZFbGVtZW50ID0gY3JlYXRlRGl2KFxyXG4gICAgICAgIFwic2V0dGluZ3Mtc2VhcmNoLWNvbnRhaW5lciB2ZXJ0aWNhbC10YWItaGVhZGVyLWdyb3VwXCJcclxuICAgICk7XHJcbiAgICBzZXR0aW5nc1Jlc3VsdHNDb250YWluZXJFbCA9IGNyZWF0ZURpdihcclxuICAgICAgICBcInNldHRpbmdzLXNlYXJjaC1yZXN1bHRzLWNvbnRhaW5lciB2ZXJ0aWNhbC10YWItY29udGVudFwiXHJcbiAgICApO1xyXG4gICAgc2V0dGluZ3NOYXZJdGVtQ29udGFpbmVyID0gdGhpcy5zZXR0aW5nc1NlYXJjaEVsXHJcbiAgICAgICAgLmNyZWF0ZURpdihcInZlcnRpY2FsLXRhYi1oZWFkZXItZ3JvdXAtaXRlbXNcIilcclxuICAgICAgICAuY3JlYXRlRGl2KFwidmVydGljYWwtdGFiLW5hdi1pdGVtIHNldHRpbmdzLXNlYXJjaC1pbnB1dFwiKTtcclxuICAgIHNldHRpbmdzUmVzdWx0c0VsOiBIVE1MRGl2RWxlbWVudDtcclxuICAgIHNlYXJjaDogU2VhcmNoQ29tcG9uZW50O1xyXG4gICAgbG9jYWxlOiBzdHJpbmc7XHJcblxyXG4gICAgcmVzb3VyY2VzOiBSZXNvdXJjZVtdID0gW107XHJcbiAgICByZXN1bHRzOiBSZXNvdXJjZVtdID0gW107XHJcblxyXG4gICAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXR0aW5nc1Jlc3VsdHNDb250YWluZXJFbC5jcmVhdGVFbChcImgzXCIsIHtcclxuICAgICAgICAgICAgICAgIHRleHQ6IFwiU2V0dGluZ3MgU2VhcmNoIFJlc3VsdHNcIlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5zZXR0aW5nc1Jlc3VsdHNFbCA9IHRoaXMuc2V0dGluZ3NSZXN1bHRzQ29udGFpbmVyRWwuY3JlYXRlRGl2KFxyXG4gICAgICAgICAgICAgICAgXCJzZXR0aW5ncy1zZWFyY2gtcmVzdWx0c1wiXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmJ1aWxkU2NvcGUoKTtcclxuICAgICAgICAgICAgdGhpcy5idWlsZFNlYXJjaCgpO1xyXG4gICAgICAgICAgICB0aGlzLmJ1aWxkUmVzb3VyY2VzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYnVpbGRQbHVnaW5SZXNvdXJjZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5wYXRjaFNldHRpbmdzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0YWJJbmRleCA9IDA7XHJcbiAgICBwbHVnaW5UYWJJbmRleCA9IDA7XHJcbiAgICBidWlsZFJlc291cmNlcygpIHtcclxuICAgICAgICBjb25zdCB0YWIgPSB0aGlzLmFwcC5zZXR0aW5nLnNldHRpbmdUYWJzW3RoaXMudGFiSW5kZXhdO1xyXG4gICAgICAgIGlmICh0YWIpIHtcclxuICAgICAgICAgICAgdGhpcy5nZXRUYWJSZXNvdXJjZXModGFiKTtcclxuICAgICAgICAgICAgdGhpcy50YWJJbmRleCsrO1xyXG4gICAgICAgICAgICBzZXRJbW1lZGlhdGUoKCkgPT4gdGhpcy5idWlsZFJlc291cmNlcygpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBidWlsZFBsdWdpblJlc291cmNlcygpIHtcclxuICAgICAgICBjb25zdCB0YWIgPSB0aGlzLmFwcC5zZXR0aW5nLnBsdWdpblRhYnNbdGhpcy5wbHVnaW5UYWJJbmRleF07XHJcbiAgICAgICAgaWYgKHRhYikge1xyXG4gICAgICAgICAgICB0aGlzLmdldFRhYlJlc291cmNlcyh0YWIpO1xyXG4gICAgICAgICAgICB0aGlzLnBsdWdpblRhYkluZGV4Kys7XHJcbiAgICAgICAgICAgIHNldEltbWVkaWF0ZSgoKSA9PiB0aGlzLmJ1aWxkUGx1Z2luUmVzb3VyY2VzKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBtYW5pZmVzdHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5hcHAucGx1Z2lucy5tYW5pZmVzdHMpO1xyXG4gICAgfVxyXG4gICAgc2V0dGluZ0NhY2hlOiBNYXA8c3RyaW5nLCBTZXR0aW5nPiA9IG5ldyBNYXAoKTtcclxuICAgIGFkZFJlc291cmNlVG9DYWNoZShyZXNvdXJjZTogUmVzb3VyY2UpIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5nID0gbmV3IFNldHRpbmcoY3JlYXRlRGl2KCkpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKHJlc291cmNlLnRleHQpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFxyXG4gICAgICAgICAgICAgICAgY3JlYXRlRnJhZ21lbnQoXHJcbiAgICAgICAgICAgICAgICAgICAgKGUpID0+IChlLmNyZWF0ZURpdigpLmlubmVySFRNTCA9IHJlc291cmNlLmRlc2MgPz8gXCJcIilcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgaWYgKHJlc291cmNlLnRhYiA9PSBcImNvbW11bml0eS1wbHVnaW5zXCIpIHtcclxuICAgICAgICAgICAgbGV0IHBsdWdpbiA9IHRoaXMubWFuaWZlc3RzLmZpbmQoKHApID0+IHAubmFtZSA9PSByZXNvdXJjZS50ZXh0KTtcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgcGx1Z2luICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcC5wbHVnaW5zLmdldFBsdWdpbihwbHVnaW4uaWQpPy5fbG9hZGVkICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLnBsdWdpblRhYnMuZmluZCgodCkgPT4gdC5pZCA9PSBwbHVnaW4uaWQpXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgc2V0dGluZy5hZGRFeHRyYUJ1dHRvbigoYikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGIuc2V0VG9vbHRpcChgT3BlbiAke3Jlc291cmNlLnRleHR9IFNldHRpbmdzYCkub25DbGljayhcclxuICAgICAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAuc2V0dGluZy5vcGVuVGFiQnlJZChwbHVnaW4uaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNvdXJjZS50YWIgPT0gXCJwbHVnaW5zXCIpIHtcclxuICAgICAgICAgICAgY29uc3QgcGx1Z2lucyA9IE9iamVjdC52YWx1ZXModGhpcy5hcHAuaW50ZXJuYWxQbHVnaW5zLnBsdWdpbnMpO1xyXG4gICAgICAgICAgICBjb25zdCBwbHVnaW4gPSBwbHVnaW5zLmZpbmQoXHJcbiAgICAgICAgICAgICAgICAocCkgPT4gcC5fbG9hZGVkICYmIHAuaW5zdGFuY2UubmFtZSA9PSByZXNvdXJjZS50ZXh0XHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBwbHVnaW4gJiZcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwLnNldHRpbmcucGx1Z2luVGFicy5maW5kKFxyXG4gICAgICAgICAgICAgICAgICAgICh0KSA9PiB0LmlkID09IHBsdWdpbi5pbnN0YW5jZS5pZFxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHNldHRpbmcuYWRkRXh0cmFCdXR0b24oKGIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBiLnNldFRvb2x0aXAoYE9wZW4gJHtyZXNvdXJjZS50ZXh0fSBTZXR0aW5nc2ApLm9uQ2xpY2soXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLnNldHRpbmcub3BlblRhYkJ5SWQocGx1Z2luLmluc3RhbmNlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBzZXR0aW5nLmFkZEV4dHJhQnV0dG9uKChiKSA9PiB7XHJcbiAgICAgICAgICAgIGIuc2V0SWNvbihcImZvcndhcmQtYXJyb3dcIikub25DbGljaygoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dSZXN1bHQocmVzb3VyY2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNldHRpbmdDYWNoZS5zZXQocmVzb3VyY2UudGV4dCwgc2V0dGluZyk7XHJcbiAgICB9XHJcbiAgICBnZXRSZXNvdXJjZUZyb21DYWNoZShyZXNvdXJjZTogUmVzb3VyY2UpIHtcclxuICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ0NhY2hlLmhhcyhyZXNvdXJjZS50ZXh0KSkge1xyXG4gICAgICAgICAgICB0aGlzLmFkZFJlc291cmNlVG9DYWNoZShyZXNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdDYWNoZS5nZXQocmVzb3VyY2UudGV4dCk7XHJcbiAgICB9XHJcbiAgICByZW1vdmVSZXNvdXJjZXNGcm9tQ2FjaGUocmVzb3VyY2VzOiBSZXNvdXJjZVtdKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCByZXNvdXJjZSBvZiByZXNvdXJjZXMpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXR0aW5nQ2FjaGUuZGVsZXRlKHJlc291cmNlLnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIGdldFRhYlJlc291cmNlcyh0YWI6IFNldHRpbmdUYWIpIHtcclxuICAgICAgICBhd2FpdCB0YWIuZGlzcGxheSgpO1xyXG5cclxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHRhYi5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxEaXZFbGVtZW50PihcclxuICAgICAgICAgICAgXCIuc2V0dGluZy1pdGVtOm5vdCguc2V0dGluZy1pdGVtLWhlYWRlcilcIlxyXG4gICAgICAgICk7XHJcbiAgICAgICAgZm9yIChjb25zdCBlbCBvZiBBcnJheS5mcm9tKHNldHRpbmdzKSkge1xyXG4gICAgICAgICAgICBjb25zdCB0ZXh0ID1cclxuICAgICAgICAgICAgICAgIGVsLnF1ZXJ5U2VsZWN0b3I8SFRNTERpdkVsZW1lbnQ+KFxyXG4gICAgICAgICAgICAgICAgICAgIFwiLnNldHRpbmctaXRlbS1uYW1lXCJcclxuICAgICAgICAgICAgICAgICk/LnRleHRDb250ZW50O1xyXG4gICAgICAgICAgICBpZiAoIXRleHQpIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGVzYyA9XHJcbiAgICAgICAgICAgICAgICBlbC5xdWVyeVNlbGVjdG9yPEhUTUxEaXZFbGVtZW50PihcIi5zZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb25cIilcclxuICAgICAgICAgICAgICAgICAgICA/LmlubmVySFRNTCA/PyBcIlwiO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVzb3VyY2UgPSB7XHJcbiAgICAgICAgICAgICAgICB0YWI6IHRhYi5pZCxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHRhYi5uYW1lLFxyXG4gICAgICAgICAgICAgICAgdGV4dCxcclxuICAgICAgICAgICAgICAgIGRlc2NcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VzLnB1c2gocmVzb3VyY2UpO1xyXG4gICAgICAgICAgICB0aGlzLmFkZFJlc291cmNlVG9DYWNoZShyZXNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmFwcC5zZXR0aW5nLmFjdGl2ZVRhYj8uaWQgPT0gdGFiLmlkKSByZXR1cm47XHJcbiAgICAgICAgdGFiLmNvbnRhaW5lckVsLmRldGFjaCgpO1xyXG4gICAgICAgIHRhYi5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcGF0Y2hTZXR0aW5ncygpIHtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcihcclxuICAgICAgICAgICAgYXJvdW5kKHRoaXMuYXBwLnNldHRpbmcsIHtcclxuICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gKG5leHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0LmFwcGx5KHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNlYXJjaC5pbnB1dEVsLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy9QYXRjaCBhZGRTZXR0aW5nVGFiIHRvIGNhcHR1cmUgY2hhbmdlcyB0byBwbHVnaW4gc2V0dGluZ3MuXHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcihcclxuICAgICAgICAgICAgYXJvdW5kKHRoaXMuYXBwLnNldHRpbmcsIHtcclxuICAgICAgICAgICAgICAgIGFkZFNldHRpbmdUYWI6IGZ1bmN0aW9uIChuZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0YWI6IFNldHRpbmdUYWIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nZXRUYWJSZXNvdXJjZXModGFiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FsbCh0aGlzLCB0YWIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy9QYXRjaCByZW1vdmVTZXR0aW5nVGFiIHRvIGNhcHR1cmUgY2hhbmdlcyB0byBwbHVnaW4gc2V0dGluZ3MuXHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcihcclxuICAgICAgICAgICAgYXJvdW5kKHRoaXMuYXBwLnNldHRpbmcsIHtcclxuICAgICAgICAgICAgICAgIHJlbW92ZVNldHRpbmdUYWI6IGZ1bmN0aW9uIChuZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0YWI6IFNldHRpbmdUYWIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNQbHVnaW5TZXR0aW5nVGFiKHRhYikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbW92aW5nID0gc2VsZi5yZXNvdXJjZXMuZmlsdGVyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0KSA9PiB0LnRhYiA9PSB0YWIuaWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc291cmNlcyA9IHNlbGYucmVzb3VyY2VzLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodCkgPT4gdC50YWIgIT0gdGFiLmlkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1vdmVSZXNvdXJjZXNGcm9tQ2FjaGUocmVtb3ZpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LmNhbGwodGhpcywgdGFiKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHRoaXMucmVnaXN0ZXIoXHJcbiAgICAgICAgICAgIGFyb3VuZCh0aGlzLmFwcC5zZXR0aW5nLCB7XHJcbiAgICAgICAgICAgICAgICBvcGVuVGFiOiBmdW5jdGlvbiAobmV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodGFiOiBTZXR0aW5nVGFiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2VhcmNoQXBwZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FsbCh0aGlzLCB0YWIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgb3BlblRhYkJ5SWQ6IGZ1bmN0aW9uIChuZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0YWI6IHN0cmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNlYXJjaEFwcGVuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LmNhbGwodGhpcywgdGFiKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgYnVpbGRTZWFyY2goKSB7XHJcbiAgICAgICAgY29uc3QgdGVtcFNldHRpbmcgPSBuZXcgU2V0dGluZyhjcmVhdGVEaXYoKSkuYWRkU2VhcmNoKChzKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoID0gcztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXR0aW5nc05hdkl0ZW1Db250YWluZXIuYXBwZW5kKHRlbXBTZXR0aW5nLmNvbnRyb2xFbCk7XHJcblxyXG4gICAgICAgIHRlbXBTZXR0aW5nLnNldHRpbmdFbC5kZXRhY2goKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZWFyY2gub25DaGFuZ2UoKHYpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSh2KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNlYXJjaC5zZXRQbGFjZWhvbGRlcihcIlNlYXJjaCBzZXR0aW5ncy4uLlwiKTtcclxuICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLnRhYkhlYWRlcnNFbC5wcmVwZW5kKHRoaXMuc2V0dGluZ3NTZWFyY2hFbCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VhcmNoQXBwZW5kZWQgPSBmYWxzZTtcclxuICAgIGFjdGl2ZUluZGV4ID0gLTE7XHJcbiAgICBhY3RpdmVTZXR0aW5nOiBTZXR0aW5nO1xyXG4gICAgc2NvcGUgPSBuZXcgU2NvcGUodGhpcy5hcHAuc2NvcGUpO1xyXG4gICAgYnVpbGRTY29wZSgpIHtcclxuICAgICAgICB0aGlzLnNjb3BlLnJlZ2lzdGVyKFtdLCBcIkFycm93RG93blwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYXJyb3dkb3duXCIpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVTZXR0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVNldHRpbmcuc2V0dGluZ0VsLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPVxyXG4gICAgICAgICAgICAgICAgKCgodGhpcy5hY3RpdmVJbmRleCArIDEpICUgdGhpcy5yZXN1bHRzLmxlbmd0aCkgK1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0cy5sZW5ndGgpICVcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0cy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNlbnRlckFjdGl2ZVNldHRpbmcoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNjb3BlLnJlZ2lzdGVyKFtdLCBcIkFycm93VXBcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImFycm93IHVwXCIpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVTZXR0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVNldHRpbmcuc2V0dGluZ0VsLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPVxyXG4gICAgICAgICAgICAgICAgKCgodGhpcy5hY3RpdmVJbmRleCAtIDEpICUgdGhpcy5yZXN1bHRzLmxlbmd0aCkgK1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0cy5sZW5ndGgpICVcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0cy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNlbnRlckFjdGl2ZVNldHRpbmcoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjZW50ZXJBY3RpdmVTZXR0aW5nKCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0c1t0aGlzLmFjdGl2ZUluZGV4XTtcclxuICAgICAgICB0aGlzLmFjdGl2ZVNldHRpbmcgPSB0aGlzLmdldFJlc291cmNlRnJvbUNhY2hlKHJlc3VsdCk7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVTZXR0aW5nLnNldHRpbmdFbC5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICAgICAgXCJcdUQ4M0RcdURFODAgfiBmaWxlOiBtYWluLnRzIH4gbGluZSAzMzMgfiB0aGlzLmFjdGl2ZVNldHRpbmcuc2V0dGluZ0VsXCIsXHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlU2V0dGluZy5zZXR0aW5nRWxcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlU2V0dGluZy5zZXR0aW5nRWwuc2Nyb2xsSW50b1ZpZXcoe1xyXG4gICAgICAgICAgICBiZWhhdmlvcjogXCJhdXRvXCIsXHJcbiAgICAgICAgICAgIGJsb2NrOiBcIm5lYXJlc3RcIlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hhbmdlKHY6IHN0cmluZykge1xyXG4gICAgICAgIGlmICghdikge1xyXG4gICAgICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLm9wZW5UYWJCeUlkKHRoaXMuYXBwLnNldHRpbmcubGFzdFRhYklkKTtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hBcHBlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmFwcC5rZXltYXAucG9wU2NvcGUodGhpcy5zY29wZSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSAtMTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuc2VhcmNoQXBwZW5kZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5hcHAuc2V0dGluZy5hY3RpdmVUYWIubmF2RWwucmVtb3ZlQ2xhc3MoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwLnNldHRpbmcudGFiQ29udGVudENvbnRhaW5lci5lbXB0eSgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLnRhYkNvbnRlbnRDb250YWluZXIuYXBwZW5kKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nc1Jlc3VsdHNDb250YWluZXJFbFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB0aGlzLnNlYXJjaEFwcGVuZGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYXBwLmtleW1hcC5wdXNoU2NvcGUodGhpcy5zY29wZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYXBwZW5kUmVzdWx0cyh0aGlzLnBlcmZvcm1GdXp6eVNlYXJjaCh2KSk7XHJcbiAgICB9XHJcbiAgICBnZXRNYXRjaFRleHQodGV4dDogc3RyaW5nLCByZXN1bHQ6IFNlYXJjaFJlc3VsdCkge1xyXG4gICAgICAgIGNvbnN0IG1hdGNoRWxlbWVudHM6IFJlY29yZDxudW1iZXIsIEhUTUxFbGVtZW50PiA9IHt9O1xyXG4gICAgICAgIHJldHVybiBjcmVhdGVGcmFnbWVudCgoY29udGVudCkgPT4ge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGxldCBtYXRjaCA9IHJlc3VsdC5tYXRjaGVzLmZpbmQoKG0pID0+IG1bMF0gPT09IGkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSByZXN1bHQubWF0Y2hlcy5pbmRleE9mKG1hdGNoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW1hdGNoRWxlbWVudHNbaW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoRWxlbWVudHNbaW5kZXhdID0gY3JlYXRlU3BhbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3VnZ2VzdGlvbi1oaWdobGlnaHRcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsZXQgZWxlbWVudCA9IG1hdGNoRWxlbWVudHNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUZXh0KHRleHQuc3Vic3RyaW5nKG1hdGNoWzBdLCBtYXRjaFsxXSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpICs9IG1hdGNoWzFdIC0gbWF0Y2hbMF0gLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kVGV4dCh0ZXh0W2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgYXBwZW5kUmVzdWx0cyhyZXN1bHRzOiBSZXNvdXJjZVtdKSB7XHJcbiAgICAgICAgdGhpcy5zZXR0aW5nc1Jlc3VsdHNFbC5lbXB0eSgpO1xyXG4gICAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBIVE1MRWxlbWVudD4gPSB7fTtcclxuICAgICAgICAgICAgZm9yIChjb25zdCByZXNvdXJjZSBvZiByZXN1bHRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIShyZXNvdXJjZS50YWIgaW4gaGVhZGVycykpIHtcclxuICAgICAgICAgICAgICAgICAgICAvKiBpZiAocmVzb3VyY2UudGFiID09IFwiaG90a2V5c1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbcmVzb3VyY2UudGFiXSA9IGNyZWF0ZURpdigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7ICovXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tyZXNvdXJjZS50YWJdID0gdGhpcy5zZXR0aW5nc1Jlc3VsdHNFbC5jcmVhdGVEaXYoKTtcclxuICAgICAgICAgICAgICAgICAgICAvKiB9ICovXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IFNldHRpbmcoaGVhZGVyc1tyZXNvdXJjZS50YWJdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0SGVhZGluZygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXROYW1lKHJlc291cmNlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmcgPSB0aGlzLmdldFJlc291cmNlRnJvbUNhY2hlKHJlc291cmNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzW3Jlc291cmNlLnRhYl0uYXBwZW5kKHNldHRpbmcuc2V0dGluZ0VsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKiBpZiAoXCJob3RrZXlzXCIgaW4gaGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nc1Jlc3VsdHNFbC5hcHBlbmRDaGlsZChoZWFkZXJzW1wiaG90a2V5c1wiXSk7XHJcbiAgICAgICAgICAgIH0gKi9cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzUmVzdWx0c0VsLnNldFRleHQoXCJObyByZXN1bHRzIGZvdW5kIDooXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzaG93UmVzdWx0KHJlc3VsdDogUmVzb3VyY2UpIHtcclxuICAgICAgICB0aGlzLnNlYXJjaC5zZXRWYWx1ZShcIlwiKTtcclxuICAgICAgICBjb25zdCB0YWIgPVxyXG4gICAgICAgICAgICB0aGlzLmFwcC5zZXR0aW5nLnNldHRpbmdUYWJzLmZpbmQoKHQpID0+IHQuaWQgPT0gcmVzdWx0LnRhYikgPz9cclxuICAgICAgICAgICAgdGhpcy5hcHAuc2V0dGluZy5wbHVnaW5UYWJzLmZpbmQoKHQpID0+IHQuaWQgPT0gcmVzdWx0LnRhYik7XHJcbiAgICAgICAgaWYgKCF0YWIpIHtcclxuICAgICAgICAgICAgbmV3IE5vdGljZShcIlRoZXJlIHdhcyBhbiBpc3N1ZSBvcGVuaW5nIHRoZSBzZXR0aW5nIHRhYi5cIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYXBwLnNldHRpbmcub3BlblRhYkJ5SWQodGFiLmlkKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgbmFtZXMgPVxyXG4gICAgICAgICAgICAgICAgdGFiLmNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2V0dGluZy1pdGVtLW5hbWVcIik7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsID0gQXJyYXkuZnJvbShuYW1lcykuZmluZChcclxuICAgICAgICAgICAgICAgIChuKSA9PiBuLnRleHRDb250ZW50ID09IHJlc3VsdC50ZXh0XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGlmICghZWwpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmcgPSBlbC5jbG9zZXN0KFwiLnNldHRpbmctaXRlbVwiKTtcclxuICAgICAgICAgICAgaWYgKCFzZXR0aW5nKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBpZiAodGFiLmlkID09IFwib2JzaWRpYW4tc3R5bGUtc2V0dGluZ3NcIikge1xyXG4gICAgICAgICAgICAgICAgbGV0IGNvbGxhcHNlZCA9IHNldHRpbmcuY2xvc2VzdChcIi5zdHlsZS1zZXR0aW5ncy1jb250YWluZXJcIik7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJldmlvdXMgPSBjb2xsYXBzZWQ/LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKFxyXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzICE9IG51bGwgJiZcclxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91cy5oYXNDbGFzcyhcImlzLWNvbGxhcHNlZFwiKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzLmhhc0NsYXNzKFwic3R5bGUtc2V0dGluZ3MtaGVhZGluZ1wiKVxyXG4gICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMucmVtb3ZlQ2xhc3MoXCJpcy1jb2xsYXBzZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VkID0gY29sbGFwc2VkLnBhcmVudEVsZW1lbnQ/LmNsb3Nlc3QoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiLnN0eWxlLXNldHRpbmdzLWNvbnRhaW5lclwiXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91cyA9IGNvbGxhcHNlZD8ucHJldmlvdXNFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGV0IGRldGFpbHMgPSBzZXR0aW5nLmNsb3Nlc3QoXCJkZXRhaWxzXCIpO1xyXG4gICAgICAgICAgICB3aGlsZSAoZGV0YWlscykge1xyXG4gICAgICAgICAgICAgICAgZGV0YWlscy5zZXRBdHRyKFwib3BlblwiLCBcIm9wZW5cIik7XHJcbiAgICAgICAgICAgICAgICBkZXRhaWxzID0gZGV0YWlscy5wYXJlbnRFbGVtZW50Py5jbG9zZXN0KFwiZGV0YWlsc1wiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0dGluZy5zY3JvbGxJbnRvVmlldyh0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNldHRpbmcuYWRkQ2xhc3MoXCJpcy1mbGFzaGluZ1wiKTtcclxuICAgICAgICAgICAgdGhpcy5yZWdpc3RlckludGVydmFsKFxyXG4gICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoXHJcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4gc2V0dGluZy5yZW1vdmVDbGFzcyhcImlzLWZsYXNoaW5nXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIDMwMDBcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHBlcmZvcm1GdXp6eVNlYXJjaChpbnB1dDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0czogUmVzb3VyY2VbXSA9IFtdLFxyXG4gICAgICAgICAgICBob3RrZXlzOiBSZXNvdXJjZVtdID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCByZXNvdXJjZSBvZiB0aGlzLnJlc291cmNlcykge1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID1cclxuICAgICAgICAgICAgICAgIHByZXBhcmVTaW1wbGVTZWFyY2goaW5wdXQpKHJlc291cmNlLnRleHQpID8/XHJcbiAgICAgICAgICAgICAgICBwcmVwYXJlU2ltcGxlU2VhcmNoKGlucHV0KShyZXNvdXJjZS5kZXNjKTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc291cmNlLnRhYiA9PSBcImhvdGtleXNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGhvdGtleXMucHVzaChyZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChyZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXN1bHRzID0gWy4uLnJlc3VsdHMsIC4uLmhvdGtleXNdO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdHM7XHJcbiAgICB9XHJcblxyXG4gICAgb251bmxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5zZXR0aW5nc1NlYXJjaEVsLmRldGFjaCgpO1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3NSZXN1bHRzRWwuZGV0YWNoKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoQXBwZW5kZWQpXHJcbiAgICAgICAgICAgIHRoaXMuYXBwLnNldHRpbmcub3BlblRhYkJ5SWQodGhpcy5hcHAuc2V0dGluZy5sYXN0VGFiSWQpO1xyXG4gICAgfVxyXG59XHJcbiIsICJleHBvcnQgZnVuY3Rpb24gYXJvdW5kKG9iaiwgZmFjdG9yaWVzKSB7XG4gICAgY29uc3QgcmVtb3ZlcnMgPSBPYmplY3Qua2V5cyhmYWN0b3JpZXMpLm1hcChrZXkgPT4gYXJvdW5kMShvYmosIGtleSwgZmFjdG9yaWVzW2tleV0pKTtcbiAgICByZXR1cm4gcmVtb3ZlcnMubGVuZ3RoID09PSAxID8gcmVtb3ZlcnNbMF0gOiBmdW5jdGlvbiAoKSB7IHJlbW92ZXJzLmZvckVhY2gociA9PiByKCkpOyB9O1xufVxuZnVuY3Rpb24gYXJvdW5kMShvYmosIG1ldGhvZCwgY3JlYXRlV3JhcHBlcikge1xuICAgIGNvbnN0IG9yaWdpbmFsID0gb2JqW21ldGhvZF0sIGhhZE93biA9IG9iai5oYXNPd25Qcm9wZXJ0eShtZXRob2QpO1xuICAgIGxldCBjdXJyZW50ID0gY3JlYXRlV3JhcHBlcihvcmlnaW5hbCk7XG4gICAgLy8gTGV0IG91ciB3cmFwcGVyIGluaGVyaXQgc3RhdGljIHByb3BzIGZyb20gdGhlIHdyYXBwaW5nIG1ldGhvZCxcbiAgICAvLyBhbmQgdGhlIHdyYXBwaW5nIG1ldGhvZCwgcHJvcHMgZnJvbSB0aGUgb3JpZ2luYWwgbWV0aG9kXG4gICAgaWYgKG9yaWdpbmFsKVxuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoY3VycmVudCwgb3JpZ2luYWwpO1xuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih3cmFwcGVyLCBjdXJyZW50KTtcbiAgICBvYmpbbWV0aG9kXSA9IHdyYXBwZXI7XG4gICAgLy8gUmV0dXJuIGEgY2FsbGJhY2sgdG8gYWxsb3cgc2FmZSByZW1vdmFsXG4gICAgcmV0dXJuIHJlbW92ZTtcbiAgICBmdW5jdGlvbiB3cmFwcGVyKC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBiZWVuIGRlYWN0aXZhdGVkIGFuZCBhcmUgbm8gbG9uZ2VyIHdyYXBwZWQsIHJlbW92ZSBvdXJzZWx2ZXNcbiAgICAgICAgaWYgKGN1cnJlbnQgPT09IG9yaWdpbmFsICYmIG9ialttZXRob2RdID09PSB3cmFwcGVyKVxuICAgICAgICAgICAgcmVtb3ZlKCk7XG4gICAgICAgIHJldHVybiBjdXJyZW50LmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH1cbiAgICBmdW5jdGlvbiByZW1vdmUoKSB7XG4gICAgICAgIC8vIElmIG5vIG90aGVyIHBhdGNoZXMsIGp1c3QgZG8gYSBkaXJlY3QgcmVtb3ZhbFxuICAgICAgICBpZiAob2JqW21ldGhvZF0gPT09IHdyYXBwZXIpIHtcbiAgICAgICAgICAgIGlmIChoYWRPd24pXG4gICAgICAgICAgICAgICAgb2JqW21ldGhvZF0gPSBvcmlnaW5hbDtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBkZWxldGUgb2JqW21ldGhvZF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnJlbnQgPT09IG9yaWdpbmFsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyBFbHNlIHBhc3MgZnV0dXJlIGNhbGxzIHRocm91Z2gsIGFuZCByZW1vdmUgd3JhcHBlciBmcm9tIHRoZSBwcm90b3R5cGUgY2hhaW5cbiAgICAgICAgY3VycmVudCA9IG9yaWdpbmFsO1xuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2Yod3JhcHBlciwgb3JpZ2luYWwgfHwgRnVuY3Rpb24pO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBkZWR1cGUoa2V5LCBvbGRGbiwgbmV3Rm4pIHtcbiAgICBjaGVja1trZXldID0ga2V5O1xuICAgIHJldHVybiBjaGVjaztcbiAgICBmdW5jdGlvbiBjaGVjayguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiAob2xkRm5ba2V5XSA9PT0ga2V5ID8gb2xkRm4gOiBuZXdGbikuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGFmdGVyKHByb21pc2UsIGNiKSB7XG4gICAgcmV0dXJuIHByb21pc2UudGhlbihjYiwgY2IpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNlcmlhbGl6ZShhc3luY0Z1bmN0aW9uKSB7XG4gICAgbGV0IGxhc3RSdW4gPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgICBmdW5jdGlvbiB3cmFwcGVyKC4uLmFyZ3MpIHtcbiAgICAgICAgcmV0dXJuIGxhc3RSdW4gPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcbiAgICAgICAgICAgIGFmdGVyKGxhc3RSdW4sICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3luY0Z1bmN0aW9uLmFwcGx5KHRoaXMsIGFyZ3MpLnRoZW4ocmVzLCByZWopO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB3cmFwcGVyLmFmdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbGFzdFJ1biA9IG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4geyBhZnRlcihsYXN0UnVuLCByZXMpOyB9KTtcbiAgICB9O1xuICAgIHJldHVybiB3cmFwcGVyO1xufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFTTzs7O0FDVEEsZ0JBQWdCLEtBQUssV0FBVztBQUNuQyxRQUFNLFdBQVcsT0FBTyxLQUFLLFdBQVcsSUFBSSxTQUFPLFFBQVEsS0FBSyxLQUFLLFVBQVU7QUFDL0UsU0FBTyxTQUFTLFdBQVcsSUFBSSxTQUFTLEtBQUssV0FBWTtBQUFFLGFBQVMsUUFBUSxPQUFLO0FBQUE7QUFBQTtBQUVyRixpQkFBaUIsS0FBSyxRQUFRLGVBQWU7QUFDekMsUUFBTSxXQUFXLElBQUksU0FB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
